---
layout: post
tags: [network] # add tag
img: internet.jpg
---

# 路由器

路由器是网络互联的核心设备，它连接不同的网络，在网络之间转发 IP 数据报

---

## 路由表

路由表中记录了从如何达到其他网络的信息。每条路由表主要由三部分组成：目的网络、子网掩码和下一站（路由器的端口 ip，也就是网关）

---

## 静态路由

> 写完立即生效
> 手工配


### 静态路由配置

> 1. 统计网络个数
> 2. 每个路由器需要配置的路由数目等于总的网络数目减去本身连接的网络数目
> 3. 配置静态路由的目的网络直接添加需要去的网络
> 4. 配置静态路由的子网掩码是需要去的网络的子网掩码
> 5. 配置静态路由的下一跳为直接相连的路由器的端口地址

![route_mode]({{site.baseurl}}/assets/img/route_model.png)


```
// R3 预配置命令
enable 
configure terminal
line console 0
no exec-timeout
logging synchronous
no ip domain lookup

// hostname R3
interface ethernet 0/0
ip address 12.1.1.1 255.255.255.0
no shutdown
exit
interface loopback 0
ip address 1.1.1.1 255.255.255.0
no shutdown
exit
// 边界配置默认路由比较省时间
ip route 0.0.0.0 0.0.0.0 12.1.1.2

// hostname R4
interface ethernet 0/0
ip address 12.1.1.2 255.255.255.0
no shutdown
exit
interface loopback 0
ip address 2.2.2.2 255.255.255.0
no shutdown
exit
interface ethernet 0/1
ip address 23.1.1.1 255.255.255.0
no shutdown
exit
// 边界配置默认路由比较省时间
ip route 1.1.1.1 255.255.255.0 12.1.1.1
ip route 3.3.3.3 255.255.255.0 23.1.1.2
```

---

### 静态路由的选择路径选择规则：

mask 匹配最长掩码

最长掩码一样，比较 AD

AD 一样，比较 metric

全都一样负载均摊

---

## 动态路由

### 按寻址算法分类

RIP、BGP

---

### 按链路状态分类

OSPF、IS-IS

---

# SVI

网关接口，用于三层交换机跨 Vlan 间路由，具体可以通过 interface vlan 接口配置命令来创建 svi，然后实现路由功能

![svi]({{site.baseurl}}/assets/img/svi-1.png)



## 配置：
 
```
// switch
Switch(config)#ip routing    //开启路由功能
Switch(config)#no ip cef    //关闭cef（这个属于模拟器的bug，真实环境下不用）

// 创建 vlan
Switch(config)# vlan 10，20
// 配置模式
Switch(config-vlan)#int e 0/0
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 10
Switch(config-if)#no shutdown
Switch(config-vlan)#int e 0/1
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 20
Switch(config-if)#no shutdown
//创建SVI接口
Switch(config)#interface vlan 10
Switch(config-if)#no sh
Switch(config-if)#ip address 192.168.1.254 255.255.255.0

Switch(config)#interface vlan 20
Switch(config-if)#no sh
Switch(config-if)#ip address 192.168.2.254 255.255.255.0

// PC 
关闭路由功能
PC1(config)#no ip routing
配置 ip
PC1(config)#interface e0/0
PC1(config-if)#no sh
PC1(config-if)#ip address 192.168.1.1 255.255.255.0
PC 配置网关
PC1(config)#ip default-gateway 192.168.1.254
```

由于是三层交换机，192.168.1.0/24 和 192.168.2.0/24 两个网段直接就可以互通了，不需要再去配置路由表，我们可以看一下路由表：

![svi-route]({{site.baseurl}}/assets/img/svi-route.png)

对三层交换机内部的讲解：

由于 e0/0 口是 access 口，所以会被打上 相应 vlan ID=10 的 tag，由于是三层交换机，通过 SVI 模拟路由器，也就是说明进行的是三层通信，可是传送过来的数据包中包含 tag，也就说明存在一个能把 tag 拆掉的 access 口才能通信，所以推测这个口是虚拟的 Vlan 10，同时 Vlan 也是通往新网段的网关

---




