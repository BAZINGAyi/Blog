---
layout: post
tags: [Git] # add tag
img: git_1.png
---

# Git 精简（三）- 撤销操作

## 改变最近的 commit 信息

`git commit --amend` **用编辑器打开最近一次的提交信息，并且改变一些提交的错误(包括文件的增删改，和提交的 messge 信息)**

> 在使用命令之前，先要将需要修改（增加／删除）的文件，提交到暂存区

---

## Revert 撤销？

关于这个 revert 查了很久，看了很多的文章基本都是一带而过，而且没有实际的案例，最后翻看 Git 的文档，终于搞清楚了它的作用，下面给出几个小例子。

> 当执行 revert 命令时，Git 会做出和 revert 的 SHA 完全相反的事情。比如，你在一个 commit A 中增加了内容 'ABCD'，假设 commit A 的 SHA 是 cdef，那么执行 `git revert cdef`,会重新创建一个commit B，并且删除 Commit A 中添加的内容 'ABCD'。


> 再比如，你在一个 commit A 中删除了内容 'ABCD'，假设 commit A 的 SHA 是 cdef，那么执行 `git revert cdef`,会重新创建一个commit B，并且增加 Commit A 中删除的内容 'ABCD'。

实践1:
1. 创建 git 仓库，并且增加文件 `a.txt`，并提交到仓库。
2. 增加 `b.txt` 文件，并提交到仓库。
3. **使用 revert 命令返回到第一次 commit，并填写弹出的 message 信息**
4. 使用 'git log',查看 commit 的提交记录

![revert]({{site.baseurl}}/assets/img/E9189C6A-7826-4A14-92FA-1C0026E3058C.jpeg)

现在我们可以来分析一下 revert 命令的作用，首先 revert 做的是和对应 SHA 相反的事情，如第一次 commit 命令，增加了 `a.txt`，而对第一次命令进行 revert 的效果是删除 `a.txt`，现在仓库只有 b 文件，并且创建了一个新的 commit 来记录 revert a。

---

## Reset 

**两个符号的使用**

1. `^` - 指向父母节点的提交
2. `~` - 指向第一次父母的提交

下面给出例子：

```
* 9ec05ca (HEAD -> master) Revert "Set page heading to "Quests & Crusades""
* db7e87a Set page heading to "Quests & Crusades"
*   796ddb0 Merge branch 'heading-update'
|\  
| * 4c9749e (heading-update) Set page heading to "Crusade"
* | 0c5975a Set page heading to "Quest"
|/  
*   1a56a81 Merge branch 'sidebar'
|\  
| * f69811c (sidebar) Update sidebar with favorite movie
| * e6c65a6 Add new sidebar content
* | e014d91 (footer) Add links to social media
* | 209752a Improve site heading for SEO
* | 3772ab1 Set background color for page
|/  
* 5bfe5e7 Add starting HTML structure
```

* HEAD^ is the db7e87a commit
* HEAD~1 is also the db7e87a commit
* HEAD^^ is the 796ddb0 commit
* HEAD~2 is also the 796ddb0 commit
* HEAD^^^ is the 0c5975a commit
* HEAD~3 is also the 0c5975a commit
* HEAD^^^2 is the 4c9749e commit (this is the grandparent's (HEAD^^) second parent (^2))

-----

**命令**

`git reset <reference-to-commit>`

> 使用 reset 命令会出现以下的效果

> 将 `HEAD` 移动到所参考的分支

> 删除所参考分支前的所有 commits

> 并将所参考分支前的所有 commit 内容移动到 工作区

---

**假设我们有一些提交记录如下，当我们运行不同的 reset 命令会发生什么呢？

  ![reset-start]({{site.baseurl}}/assets/img/reset-start.png)
  
`git reset --mixed HEAD~1`

![reset-mixed]({{site.baseurl}}/assets/img/CF51F610-9E5A-45E2-AEC2-E7833DE70817.png)

`git reset --softed HEAD~1`

![reset-soft]({{site.baseurl}}/assets/img/reset-soft.png)

`git reset --hard HEAD~1`

![reset-hard]({{site.baseurl}}/assets/img/48E7F6BD-CCF4-476A-AD0D-DDB3EA0CEEC6.png)

---

**撤销 reset 操作**

当你发现使用 reset 命令错误的删除了一个 commit 记录后，需要撤销 reset 命令，可以使用 `git relog` 查看撤销之前的 commit 的 SHA，
再用 reset 命令返回去就可以了。

