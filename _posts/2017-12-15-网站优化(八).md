---
layout: post
tags: [js] # add tag
img: luca-bravo-217276-min.jpg
---

[TOC]


# Pipe - Painting 的优化

可以通过 Chrome 下的 Rendering 选中的 show Paint rectangle 复选框 来查看当前页面的那些部分 Painting 在绘制

在 Main 条目中，找到 Paint 框，可以看到那些区域正在被绘制和已经被绘制完的部分，如下图所示

![Painting](/assets/img/15133214376426.jpg)



# Pipeline - Compositing 优化

## 图层合成的分析

![compositing](/assets/img/15133073707307.jpg)

通过 chrome 工具，我们可以看到有两个操作分别与合成图层相关，第一个是 `Update Layer Tree`, 它发生在 chrome 的内部引擎计算哪个图层需要出现在当前的页面上，它会查看元素的样式和计算所有元素的顺序和需要多少个图层

`Composite Layers` 是将所有图层合成在一起然后发送到屏幕上，图层越多，图层管理和花费的时间就会越多

所以我们需要在降低绘制时间和合成图层时作出一定的权衡
 
 
## 利用 chrome 分析页面上的图层情况
 
 通过 `option command i` 打开 Devtools，选择 Rendering 选项打开 Layer borders
 
 ![Devtools](/assets/img/15133080932530.jpg)

这时的页面上显示了相应的图层

![example](/assets/img/15133081521926.jpg)


淡颜色的方块是浏览器奖每个图层拆分成图块的一种方式，我们是无法控制这样的图层的

橘红色的方块是表示的元素是位于自己的合成图层上，这样的图层就是我们能控制的

点击录制中的任意一帧后，我们可以通过 Layer 来了解当前的页面的绘制情况



## 创建图层

在 Chrome 和 Firefox 中：

```css
.circle {
    will-change: transform;
}
```

对于旧版浏览器和 Safari 中：

```
.circle {
    transform: translateZ(0);
}
```

将元素放进独立的图层汇总非常有助于避免绘制问题，特别适合在动作或透明度相关的改变

当需要注意的是图层管理和渲染层合成不是独立分开的，需要在二者之间找到平衡点







