---
layout: post
tags: [network] # add tag
img: internet.jpg
---

# 交换机的发展史

## 集线器 (Hub)

### 介绍

对收到的信号进行放大，以扩大网络的传输距离。同时把所有节点集中在以它为中心的节点上，工作在物理层

集线器发送数据没有针对性，而是采用广播的形式发送，也就是说当它要向某个节点发送数据时，不是直接把数据发送到目的端口，而是把**数据包**发送到会集线器相连的所有节点

当以 HUB 为中心设备时，网络中某条线路发生了故障并不影响其他的端口工作

HUB 的工作方式时半双工

---

### CSMA／CD，载波监听多路检测

由于 hub 的工作方式是半双工，进而会产生冲突。解决问题的方法就是 CSMA／CD

实现 CSMA／CD 的方法就是：

先听后发

边听边发

冲突停发

随机分配

---

## 网桥(桥接器)

网桥是早期的两端口二层网络设备，用来连接不同网段。

基于软件转发，可能会出现计算量的问题

---

## 交换机

### 优点

基于硬件转发，转发的速度是线性的

默认全双工

大量的真缓存

端口很多

### 功能

当交换机收到数据时，检查数据包中的目的 MAC 地址，然后把数据从目的所在的主机转发出去

### 交换机的原理

> 交换机之所以能实现这一功能，是因为交换机内部有一张 **MAC** 地址表，表中记录了网络中所有 MAC 地址和该交换机各端口的对应信息，以及老化时间(300s)

收到数据处理步骤：

先学习，记录**源地址**，和交换机本身的端口号，再看目的地址，是进行泛红，转发还是丢弃
> 规范：
> 1. 交换机只记录**源 MAC 地址**（因为通常来说数据都是有来有回的，这样双方的 MAC 地址都能记住）
> 2. 广播帧和组播帧向所有的端口进行转发
> 3. 泛洪：收到未知单播帧（MAC 地址未知）或者广播帧
> 4. 转发：收到已知的单播帧
> 5. 丢弃：FCS 损坏，或者下挂 HUB(暂不理解)

---

# 传输介质

## 同轴电缆

## 双绞线（应用较多）

**568b**

线序为： 橙白 橙，绿白，蓝，蓝白，绿，粽白，粽

1，2 发送数据

3，6 接受数据

## 光纤

多模光纤（ST）

单模光纤（远距离，带宽高，SC，LC，FC）

## 直通线和双绞线的区别

直通线(568b)不同种的设备

交叉线(568a,568b) 同种设备

> 这里的同种指的是都是 2 层或都是 3 层的设备

---

# 概念介绍

## MAC 地址

大小为6 字节，48 bits. 前 24 bits 由 OUI 组成，后 24 bits 由 vendor assigned 组成

## 数据帧结构

<img src="{{site.baseurl}}/assets/img/15104116888246.jpg" alt="data-frame" />

---

## ARP 介绍

> 完成 IP 地址到物理地址的映射
> ARP 不能穿越路由器
> ARP 报文的结构一会在实际抓包中，下一讲中详细演示

### ARP 原理

![switch1]({{site.baseurl}}/assets/img/S2AEC8M%5B-Z%5BSJUA%7DW57FQ%25C%202.png)

> 把路由器的路由功能关闭，这里的 R1 代表的就是 PC 了，否则是 Ping 不通的
> 这里出现的设备均是第一次启动

这里 R1 想要给 PC 发送 **IP 数据包**，只有按照要求封装成 2 层数据帧的格式才可以。这时发现目前有源 MAC 地址，却没有目的 MAC 地址，那么封包不成功，暂时将包搁置。接着发送 ARP 广播（将 ARP 广播添加帧头部发送），交换机转发该广播到该网络的每一个主机，每个主机收到后开始解封装，进而查看到 ARP 报文中的目的 IP，如果该 IP 和自己的 IP 一致，那么做出 ARP 响应报文，否则丢弃。R1 收到 PC 的响应报文后，开始解封装，并查看 ARP 报文中的目的 IP，添加到搁置的缺少目的 MAC 的数据包，进而发送到数据到 PC


### ARP 分类

标准 ARP：上面原理中讲到的 ARP

无故(免费) ARP：用于检测同网段是否冲突，目的和源 IP 都是自己
> 如果想抓到 无故 ARP，需要在配置前抓包

